# For a full configuration reference, see: https://grafana.com/docs/agent/latest/configuration/.
server:
  log_level: info

metrics:
  global:
    scrape_interval: 1m
  wal_directory: '/var/lib/grafana-agent'
  configs:
    - name: default
      host_filter: false
      remote_write:
        - url: {{ grafana_agent.metrics_write.url }}
      scrape_configs:
        - job_name: grafana-agent
          static_configs:
            - targets: ['127.0.0.1:{{ grafana_agent.port }}']
{% if node_exporter is defined and node_exporter.enabled | bool %}
        - job_name: node_exporter
          static_configs:
            - targets: ['127.0.0.1:{{ node_exporter.port }}']
{% endif %}
{% if promtail is defined and promtail.enabled | bool %}
        - job_name: promtail
          static_configs:
            - targets: ['127.0.0.1:{{ promtail.port }}']
{% endif %}

logs:
  configs:
  - name: default
    positions:
      filename: /tmp/positions.yaml
    clients:
      - url: {{ grafana_agent.logs_write.url }}
    scrape_configs:
      - job_name: varlogs
        static_configs:
          - targets: [localhost]
            labels:
              job: varlogs
              __path__: /var/log/*log